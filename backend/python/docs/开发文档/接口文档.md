# 网站功能开发

## 1. 基础功能

### 1.1 用户模块

#### 1.1.1 注册/登录，获取token

手机号为系统唯一性标识，基础信息全部在user表中，有是否员工标识

患者、医生、员工可以统一登录，不限于账号密码登录、手机验证码登录、微信公众号小程序登录等

默认所有用户都是患者用户，可以自己修改密码

员工，由系统管理员设定，改变员工标识，部门、角色等设置

医生，分为预备数据，正式数据两类，预备数据由两种数据源：爬虫抓取全国医生数据和销售录入，审核通过后，成为正式数据，进入ERP实际有效的医生

方式一：输入手机号，获取验证码，验证通过即可注册登录，不限于PC、H5、APP等平台

方式二：微信公众号、微信小程序，授权登录、授权获取手机号后，可直接登录，用手机号做区分，如果有异常的，手机号过期、换号等，联系管理员

##### 1.1.1.1 获取验证码

| 接口编号 | 接口名称  | 版本号 | 内容                               | 开发人 | 创建时间   | 更新时间   |
| -------- | --------- | ------ | ---------------------------------- | ------ | ---------- | ---------- |
| AEGI0001 | 注册/登录 | v1.0   | 完成基本登录注册功能，手机号码验证 | 李姜   | 2021/04/01 | 2021/04/21 |
| AEGI0001 | 注册/登录 | v1.1   | 添加获取token                      | 李姜   | 2021/04/05 | 2021/04/23 |

**URL地址：**

```
/auth/getCaptcha
```

**请求：**

| 参数名称 | 数据类型 | 是否必填 | 参数描述       | 参数示例             | 备注     |
| -------- | -------- | -------- | -------------- | -------------------- | -------- |
| token    | string   | 是       | token 验证信息 | "faslkdff7923roujoi" | v1.2添加 |
| phone    | string   | 是       | 手机号，11位   | 13012345678          | v1.1     |



```json
{
    "phone":"13012345678"
}
```

**结果：**

成功返回：

```json
{
    "state":2000,
    "msg":"验证码发送成功！"
}
```

失败结果：

```json
{
    "state":4001,
    "msg":"验证码发送失败，请联系管理员，电话0755-88888888"
}
```



##### 1.1.1.2 提交登录

说明：此接口只提供验证码验证功能，验证失败，停留当前页面，验证通过，前端业务控制后续流程

**URL地址：**

```url
/auth/checkCaptcha
```

**请求：**

```json
{
	"phone":"13012345678",
    "code":1234
}
```

**结果：**

成功：

```json
{
    "state":2000,
    "msg":"验证通过",
    "data":{
        "userid":"534532",
        "username":"福克斯"
    }
}
```

失败：

```json
{
    "state":4002,
    "msg":"您输入的验证码错误，请查证后重新输入"
}
```

### 1.2 权限模块

#### 1.2.1 权限列表

##### 1.2.1.1 获取权限列表

**URL地址：**

```url
/auth/authority/members
```

**请求：**

```json
{
    
}
```

**结果：**

成功

```json
{
    "state":2000,
    "msg":"获取权限列表成功",
    "data":[
        {
            "user_id":234,
            "user_name":"李全",
            "authorities":[
                {
                    "role_id":22,
                    "role_name":"实验室管理员",
                },
            ]
        }
    ]
}
```

失败

```json
{
    "state": 4003,
    "msg":"获取权限列表失败：没有权限"
}
```

##### 1.2.1.2 设置人员权限

给某个部门设定权限角色，一个部门可以设置多个角色

URL地址：

```url
/auth/authority/setAuthority
```

请求：

```json
{
    "user_id":343,
    "role_ids":[12,23]
}
```

**结果**：

成功：

```json
{
    "state":2000,
    "msg":"设置角色成功"
}
```

失败：

```json
{
    "state":4004,
    "msg":"设置角色失败"
}
```



#### 1.2.2 角色定义

##### 1.2.2.1 获取角色列表

**URL地址**

```url
/auth/role/list
```

**请求：**

```json
{
    
}
```

**结果：**

成功：

```json
{
    "state":2000,
    "msg":"获取角色列表成功",
    "data":[
        {
            "role_id":234,
            "role_name":"lab_leader",
            "role_label":"实验室管理员",
            "authorities":[
                {
                    "operate_id":22,
                    "operate_name":"sample_receive",
                    "operate_label":"样本接收",
                },
                {
                    "operate_id":23,
                    "operate_name":"sample_receipt",
                    "operate_label":"样本入库",
                },
            ]
        }
    ]
}
```

失败：

```json
{
    "state":4004,
    "msg":"获取角色失败"
}
```



#### 1.2.3 我的权限（接口）

返回分配我的角色列表，权限列表

前端判断有某个权限，可以打开某个页面，可以显示某个按钮，可以点击提交交互，可以展示某些列

**URL地址：**

```url
/auth/myAuthorities
```

**请求：**

```json
{
    
}
```

**结果：**

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "role_id":234,
            "role_name":"lab_leader",
            "role_label":"实验室管理员",
            "authorities":[
                {
                    "operate_id":22,
                    "operate_name":"sample_receive",
                    "operate_label":"样本接收",
                },
                {
                    "operate_id":23,
                    "operate_name":"sample_receipt",
                    "operate_label":"样本入库",
                },
            ]
        }
    ]
}
```

### 1.3 参数设置

#### 1.3.1 系统参数设置

##### 1.3.1.1 获取系统参数列表

**URL地址**

```url
/system/config/list
```

请求：

```json
{
    
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
          "datatype":"text",
          "flag":false,
          "id":1003,
          "label":"系统标题",
          "name":"company_title",
          "options":"",
          "pid":0,
          "state":false,
          "value":"安吉康尔"
        }
    ]
}
```

失败：

```json
{
    "state":4004,
    "msg":"获取参数列表失败"
}
```

##### 1.3.1.2 添加系统参数

URL地址：

```url
/system/config/add
```

请求：

```json
{
    "datatype":"text",
    "flag":false,
    "label":"系统标题",
    "name":"company_title",
    "options":"",
    "pid":0,
    "state":false,
    "value":"安吉康尔"
}
```

结果：

成功：

```json
{
    "state":2000,
    "msg":"success"
}
```

失败：

```json
{
    "state":4005,
    "msg":"添加失败，请重新提交"
}
```



#### 1.3.2 业务参数设置

##### 1.3.2.1 获取业务参数列表

**URL地址**

```url
/system/businessConfig/list
```

请求：

```json
{
    
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
          "datatype":"",
          "flag":false,
          "id":1001,
          "label":"实验排期自动审核时间",
          "name":"lab_autocheck_time",
          "options":"",
          "pid":0,
          "state":false,
          "value":""
        }
    ]
}
```

失败：

```json
{
    "state":4004,
    "msg":"获取参数列表失败"
}
```

##### 1.3.2.2 添加系统参数

URL地址：

```url
/system/businessConfig/add
```

请求：

```json
{
    "datatype":"",
    "flag":false,
    "id":1001,
    "label":"实验排期自动审核时间",
    "name":"lab_autocheck_time",
    "options":"",
    "pid":0,
    "state":false,
    "value":""
}
```

结果：

成功：

```json
{
    "state":2000,
    "msg":"success"
}
```

失败：

```json
{
    "state":4005,
    "msg":"添加失败，请重新提交"
}
```



#### 1.3.3 其他参数设置

##### 1.3.3.1 省市县三级联动数据

URL地址：

```url
/system/area/list
```

请求：

```json
{
    
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "code":"11",
            "name":"北京市",
            "children":[
                {
                    "code":"1101",
                    "name":"市辖区",
                    "children":[
                        {
                            "code":"110101",
                            "name":"东城区"
                        }
                    ]
                }
            ]
        }
   ]
}
```

失败：

```json
{
    "state":4005,
    "msg":"获取失败"
}
```

### 1.4 日志功能

#### 1.4.1 系统日志

##### 1.4.1.1 查询日志

**URL地址：**

```url
/system/diary/system
```

请求：

```json
{
    "begin":"2021/03/01 00:00:00",
    "end":"2021/03/31 23:59:59",
    "size":50,
    "page":2
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
          "flag":false,
          "handle":"",
          "id":10002,
          "input":"",
          "ip":"127.0.0.1",
          "object":"4127342",
          "operation":"订单审核",
          "output":"",
          "remark":"",
          "result":"",
          "state":false,
          "target":"order",
          "time":"",
          "token":"fsfasdfsfdas",
          "user_agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36",
          "userid":2048,
          "username":"yuelong.chen@aegicare.com"
        },
        {
          "flag":false,
          "handle":"",
          "id":10003,
          "input":"",
          "ip":"127.0.0.1",
          "object":"4127342",
          "operation":"订单审核",
          "output":"",
          "remark":"",
          "result":"",
          "state":false,
          "target":"order",
          "time":"",
          "token":"fsfasdfsfdas",
          "user_agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36",
          "userid":2048,
          "username":"yuelong.chen@aegicare.com"
        }
    ]
}
```

失败：

```json
{
    "state":4005,
    "msg":"失败"
}
```



#### 1.4.2 登录日志

##### 1.4.2.1 查询登录日志

**URL地址：**

```url
/system/diary/login
```

请求：

```json
{
    "begin":"2021/03/01 00:00:00",
    "end":"2021/03/31 23:59:59",
    "size":50,
    "page":2
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "flag":false,
            "handle":"",
            "id":10000,
            "input":"",
            "ip":"127.0.0.1",
            "operation":"login",
            "output":"",
            "remark":"",
            "result":"",
            "state":false,
            "time":"",
            "token":"",
            "user_agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36",
            "userid":2045,
            "username":"yangqisheng@aegicare.cn"
        },
        {
            "flag":false,
            "handle":"",
            "id":10000,
            "input":"",
            "ip":"127.0.0.1",
            "operation":"login",
            "output":"",
            "remark":"",
            "result":"",
            "state":false,
            "time":"",
            "token":"",
            "user_agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36",
            "userid":2045,
            "username":"yangqisheng@aegicare.cn"
        }
    ]
}
```

失败：

```json
{
    "state":4005,
    "msg":"失败"
}
```



### 1.5 文件功能

files 文件表，

file_store_type 文件存储类型，本地 local,云端cloud



#### 1.5.1 云端文件

头像、判断结果图片等

##### 1.5.1.1 文件列表

URL地址：

```url
/file/cloud/list
```

请求：

```json
{
    "dirname":"/",
    "file_type":"*"
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "filepath":"/system/logo.png",
            "is_file":true,
            "file_type":"image/png"
        },
        {
            "filepath":"/clinical/",
            "is_file":false,
            "file_type":"",
        },
        {
            "filepath":"/reports/",
            "is_file":false,
            "file_type":"",
        }
    ]
}
```



#### 1.5.2 本地文件

实验数据，分析结果等

### 1.6 通知 notice

#### 1.6.1 系统消息

#### 1.6.2 个人消息

### 1.7 消息 message

#### 1.7.1 类型设置

短信、邮件

#### 1.7.2 发送记录

### 1.8 日历

#### 1.8.1 假期设置维护

#### 1.8.2 工作日计算

### 1.9 定时任务

#### 1.9.1 定时统计

#### 1.9.2 定时通知

## 2. 业务功能

### 2.1 资源管理

#### 2.1.1 用户管理（患者）

##### 2.1.1.1 获取用户列表

URL地址

```url
/resources/user/list
```

请求：

```json
{
    "page":2,
    "size":20,
    "token":"424jasd8809423"
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
          'ap':'AP23350',
          'af':'AF23330',
          'name': '*佳豪',
          'gender': '男',
          'birth': '1995/12/12',
          'province': '广东',
          'city': '深圳',
          'county': '南山区',
          'address': '大冲城市花园',
          'referent': 'AP23333',
          'relation': '爸爸',
          'saler':'12312',
          'regtime': '2020/08/02 14:23:12',
          'is_contact': true,
          'remark': '',
        },
        {
          'ap':'AP23351',
          'af':'AF23330',
          'name': '*佳豪',
          'gender': '男',
          'birth': '1995/12/12',
          'province': '广东',
          'city': '深圳',
          'county': '南山区',
          'address': '大冲城市花园',
          'referent': 'AP23333',
          'relation': '爸爸',
          'saler':'12312',
          'regtime': '2020/08/02 14:23:12',
          'is_contact': true,
          'remark': '',
        },
    ]
}
```

失败：

```json
{
    "state":4005,
    "msg":"获取失败"
}
```



#### 2.1.2 医生管理

##### 2.1.2.1 获取医生数据列表

URL地址：

```url
/resources/doctor/list
```

请求：

```json
{
    "token":"123erser234", // 必填
    "page":1, // 非必填，默认1
    "size":20, // 非必填，默认20
}
```

响应：

成功：

```json
{
    "state":2000,
    "msg":"success",
    "data":[
        {
            "avatar":"",
            "brief":"",
            "code":"DT1026",
            "department_code":"",
            "department_name":"",
            "doctor_interest":"",
            "email":"",
            "expert":"",
            "flag":false,
            "handler_id":0,
            "handler_name":"",
            "hospital_code":"HP1009",
            "hospital_name":"",
            "id":6025,
            "label":"",
            "name":"朱峰",
            "papers":{

            },
            "phone":"",
            "score":0,
            "state":false,
            "tags":{

            },
            "title":"主治医师"
        },
        {
            "avatar":"",
            "brief":"",
            "code":"DT1040",
            "department_code":"",
            "department_name":"",
            "doctor_interest":"",
            "email":"",
            "expert":"",
            "flag":false,
            "handler_id":0,
            "handler_name":"",
            "hospital_code":"HP1011",
            "hospital_name":"",
            "id":6022,
            "label":"",
            "name":"戴启麟",
            "papers":{

            },
            "phone":"",
            "score":0,
            "state":false,
            "tags":{

            },
            "title":"主任医师"
        },
    ]
}
```

失败：

```json
{
    "state":4006,
    "msg":"失败"
}
```



#### 2.1.3 医院管理



#### 2.1.4 机构管理（科研等）

#### 2.1.5 产品管理

#### 2.1.6 样本管理

#### 2.1.7 项目管理

### 2.2 销售管理

#### 2.2.1 用户录入

#### 2.2.2 样本录入

#### 2.2.3 订单录入

#### 2.2.4 我负责的用户

患者、医生、医院

随访记录

#### 2.2.5 待审核初步报告

#### 2.2.6 报告交付管理

### 2.3 研发管理

#### 2.3.1 科研项目

#### 2.3.2 科技服务

#### 2.3.3 科研录单

#### 2.3.4 科研订单进度跟踪

### 2.4 生产管理

#### 2.4.1 生产面板数据统计

#### 2.4.2 在产记录，checklist 

#### 2.4.3 实验单管理

#### 2.4.4 实验问题样本

#### 2.4.5 生信分析管理

#### 2.4.6 我的生信分析

#### 2.4.7 生信质控

#### 2.4.8 生信问题样本

#### 2.4.9 医学待审核订单

#### 2.4.10 医学报告管理

#### 2.4.11 我的医学报告

#### 2.4.12 我负责的用户

#### 2.4.13 医学问题样本

#### 2.4.14 生产问题样本

#### 2.4.15 生产日志

#### 2.4.16 医学报告互审设置

#### 2.4.17 异常申请

价格调整、样本类型修改、医学报告改负责人等

### 2.5 财务管理

#### 2.5.1 支付方式设置

#### 2.5.2 订单对账

账单bill对应order 分解到订单

账单详情bill_detail 对应order_detail 分解到产品

#### 2.5.3 回款管理

#### 2.5.4 发票管理

### 2.6 人事管理

#### 2.6.1 部门管理

#### 2.6.2 人员管理

#### 2.6.3 权限角色管理

#### 2.6.4 绩效管理

### 2.7 统计分析

statistics_daily,statistics_weeekly,statistics_monthly,statistics_quarterly,statistics_yearly

#### 2.7.1 销售统计

#### 2.7.2 生产统计



